<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style-clock.css">
<title>D&D Vil√°gid≈ë kezel≈ë</title>

</head>
<body>

<!-- nav bar --> 

<nav id="nav">
  <ul>
    <li><a href="nagy t√©rk√©p.html">big map</a>
    <li><a href="carft\index.html">crafting</a>
    <li><a href="cooking.html">cooking</a>
    <li><a href="browing.html">brewing</a></li>
    <button class="dmprof" onclick="dmpoff()">profile</button>
  </ul>
</nav>

<h1>D&D Vil√°gid≈ë kezel≈ë</h1>

<!-- to do list --> 
<div class="to-do">
  <h2>To-Do Lista</h2>

  <input type="text" id="todoInput" placeholder="√çrd be a teend≈ët..." />
  <button id="addBtn" onclick="addTodo()">Hozz√°ad√°s</button>

  <ul id="todoList"></ul>
</div>


<div id="worldTime">Bet√∂lt√©s...</div>
<canvas id="dayCycleCanvas" width="240" height="240" aria-label="Napszak √©s id≈ë jelz≈ë"></canvas>
<div id="weatherDisplay">Bet√∂lt√©s...</div>
<div id="eventDisplay" style="margin-top: 10px; padding: 10px; color: rgb(255, 255, 221)">Napi esem√©ny: ...</div>
<div id="magic-status" style="color: white;padding:12px;font-weight: bold;font-family: Arial,sans-serif;">M√°giaszint: <span id="magic-level-text">Norm√°l</span></div>


<!-- Pihen√©s gombok -->
<div style="margin-top: 20px;">
  <button id="shortRestBtn" title="R√∂vid pihen√©s (1 √≥ra)">R√∂vid pihen√©s (1 √≥ra)</button>
  <button id="longRestBtn" title="Hossz√∫ pihen√©s (8 √≥ra)">Hossz√∫ pihen√©s (8 √≥ra)</button>
</div>

<!-- DM bel√©p≈ë -->
<div id="dmLoginSection" style="display: 'none';">
  <h3>DM bel√©p√©s</h3>
  <input type="password" id="dmPasswordInput" placeholder="√çrd be a jelsz√≥t" autocomplete="off" />
  <button id="dmLoginBtn">Bel√©p√©s</button>
  <div id="dmLoginError"></div>
</div>

<!-- DM vez√©rl≈ëpanel -->
<div id="dmPanel" aria-live="polite">
  <h3>DM vez√©rl≈ëpanel</h3>

  <label for="timeSetInput">Vil√°gid≈ë be√°ll√≠t√°sa</label>
  <input type="datetime-local" id="timeSetInput" step="60" />

  <label for="timeSpeedInput">Id≈ësebess√©g (1x alap, max 120x)</label>
  <input type="number" id="timeSpeedInput" min="0" max="120" step="0.1" value="1" />

  <label for="weatherSelect">Id≈ëj√°r√°s</label>
  <select id="weatherSelect">
    <option value="auto">Automatikus</option>
    <option value="clear">Tiszta</option>
    <option value="cloudy">Felh≈ës</option>
    <option value="rain">Es≈ë</option>
    <option value="storm">Vihar</option>
    <option value="snow">H√≥</option>
  </select>

  <label for="magicSelect">M√°gia √°llapota</label>
  <select id="magicSelect">
    <option value="auto">Automatikus</option>
    <option value="high">Er≈ës</option>
    <option value="normal">Norm√°l</option>
    <option value="low">Gyenge</option>
    <option value="null">Nincs</option>
  </select>

  <button id="logoutBtn" style="background:#b04a4a;">Kijelentkez√©s</button>
  <div id="dmFeedback" aria-live="assertive"></div>
</div>

<script>
  // --- V√°ltoz√≥k ---
  const worldTimeEl = document.getElementById('worldTime');
  const dayCycleCanvas = document.getElementById('dayCycleCanvas');
  const weatherDisplay = document.getElementById('weatherDisplay');

  const shortRestBtn = document.getElementById('shortRestBtn');
  const longRestBtn = document.getElementById('longRestBtn');

  const todoInput = document.getElementById('todoInput');
  const addBtn = document.getElementById('addBtn');
  const todoList = document.getElementById('todoList');
  // DM elemek
  const dmLoginSection = document.getElementById('dmLoginSection');
  const dmPasswordInput = document.getElementById('dmPasswordInput');
  const dmLoginBtn = document.getElementById('dmLoginBtn');
  const dmLoginError = document.getElementById('dmLoginError');

  const dmPanel = document.getElementById('dmPanel');
  const timeSetInput = document.getElementById('timeSetInput');
  const timeSpeedInput = document.getElementById('timeSpeedInput');
  const weatherSelect = document.getElementById('weatherSelect');
  const logoutBtn = document.getElementById('logoutBtn');
  const dmFeedback = document.getElementById('dmFeedback');

  // --- √Ållapot ---
  // Alap vil√°gid≈ë: √©v 467, 1 Jan 00:00 UTC
  let worldTime = new Date(Date.UTC(467, 0, 1, 0, 0, 0));
  let timeSpeed = 1; // 1x id≈ësebess√©g alap
  let lastUpdate = Date.now();

  // Id≈ëj√°r√°s √°llapot
  let weatherAuto = true;
  let currentWeather = 'clear';

  // DM jelsz√≥ (p√©lda, k√©s≈ëbb √°t√°ll√≠that√≥)
  const DM_PASSWORD = 'dm1234';

  // --- Seg√©df√ºggv√©nyek ---

  // Seg√©dsz√≠n interpol√°ci√≥
  function getColorInterpolation(varName1, varName2, t) {
    const color1 = getComputedStyle(document.documentElement).getPropertyValue(varName1).trim();
    const color2 = getComputedStyle(document.documentElement).getPropertyValue(varName2).trim();

    function hexToRgb(hex) {
      if (hex[0] === '#') hex = hex.slice(1);
      if (hex.length === 3) hex = hex.split('').map(c => c + c).join('');
      const bigint = parseInt(hex, 16);
      return {
        r: (bigint >> 16) & 255,
        g: (bigint >> 8) & 255,
        b: bigint & 255,
      };
    }

    const c1 = hexToRgb(color1);
    const c2 = hexToRgb(color2);

    const r = Math.round(c1.r + (c2.r - c1.r) * t);
    const g = Math.round(c1.g + (c2.g - c1.g) * t);
    const b = Math.round(c1.b + (c2.b - c1.b) * t);

    return `rgb(${r},${g},${b})`;
  }

  // Friss√≠ti a vil√°gid≈ë kijelz√©st (pl. "467. 01. 01. 00:00")
  function updateWorldTimeDisplay() {
    const y = worldTime.getUTCFullYear();
    const mo = (worldTime.getUTCMonth() + 1).toString().padStart(2, '0');
    const d = worldTime.getUTCDate().toString().padStart(2, '0');
    const h = worldTime.getUTCHours().toString().padStart(2, '0');
    const mi = worldTime.getUTCMinutes().toString().padStart(2, '0');
    worldTimeEl.textContent = `${y}.${mo}.${d}. // ${h}:${mi}`;
  }

  // Friss√≠ti a napk√∂rt (canvas)
  function updateDayCycle() {
    const ctx = dayCycleCanvas.getContext('2d');
    const cx = dayCycleCanvas.width / 2;
    const cy = dayCycleCanvas.height / 2;
    const radius = 100;

    const hour = worldTime.getUTCHours() + worldTime.getUTCMinutes() / 60;

    let dayColor;
    if (hour >= 5 && hour < 7) dayColor = getColorInterpolation('--color-midnight', '--color-dawn', (hour - 5) / 2);
    else if (hour >= 7 && hour < 12) dayColor = getColorInterpolation('--color-dawn', '--color-morning', (hour - 7) / 5);
    else if (hour >= 12 && hour < 15) dayColor = getColorInterpolation('--color-morning', '--color-noon', (hour - 12) / 3);
    else if (hour >= 15 && hour < 18) dayColor = getColorInterpolation('--color-noon', '--color-afternoon', (hour - 15) / 3);
    else if (hour >= 18 && hour < 20) dayColor = getColorInterpolation('--color-afternoon', '--color-evening', (hour - 18) / 2);
    else if (hour >= 20 && hour < 24) dayColor = getColorInterpolation('--color-evening', '--color-night', (hour - 20) / 4);
    else dayColor = getColorInterpolation('--color-night', '--color-midnight', hour / 5);

    ctx.clearRect(0, 0, dayCycleCanvas.width, dayCycleCanvas.height);
    const gradient = ctx.createRadialGradient(cx, cy, radius * 0.3, cx, cy, radius);
    gradient.addColorStop(0, dayColor);
    gradient.addColorStop(1, '#0a1a38');

    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(cx, cy, radius, 0, Math.PI * 2);
    ctx.fill();

    // √ìra mutat√≥
    const angle = (hour / 24) * 2 * Math.PI - Math.PI / 2;
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(cx + Math.cos(angle) * radius * 0.85, cy + Math.sin(angle) * radius * 0.85);
    ctx.stroke();

    // K√∂z√©ppont nap jelz√©s
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(cx, cy, 8, 0, 2 * Math.PI);
    ctx.fill();
  }

  // Id≈ëj√°r√°s meghat√°roz√°sa automata m√≥dban (napf√©ny, √≥rasz√°m, stb.)
  function seededRandom(seed) {
  const x = Math.sin(seed) * 10000;
  return x - Math.floor(x);
}

function determineAutoWeather() {
  const hour = worldTime.getUTCHours();
  const minute = worldTime.getUTCMinutes();

  // Kisz√°molunk egy sz√°mot, pl nap √©s √≥ra alapj√°n
  // √çgy az id≈ëj√°r√°s stabil lesz minden √≥r√°ra
  const day = Math.floor(worldTime.getTime() / (1000 * 60 * 60 * 24)); // teljes napok sz√°ma
  const hourSeed = day * 24 + hour; // minden √≥r√°nak k√ºl√∂n seedje van

  const rand = seededRandom(hourSeed);

  const dayFraction = (hour + minute / 60) / 24;

  if (dayFraction >= 0.25 && dayFraction < 0.75) {
    // Nappal - 80% tiszta, 15% felh≈ës, 5% es≈ë
    if (rand < 0.8) return 'clear';
    if (rand < 0.95) return 'cloudy';
    return 'rain';
  } else {
    // √âjszaka - 50% tiszta, 30% felh≈ës, 20% vihar vagy h√≥
    if (rand < 0.5) return 'clear';
    if (rand < 0.8) return 'cloudy';
    if (rand < 0.9) return 'storm';
    return 'snow';
  }
}

  // Id≈ëj√°r√°s megjelen√≠t√©se
  function updateWeatherDisplay() {
    if (weatherAuto) {
      currentWeather = determineAutoWeather();
      weatherSelect.value = 'auto';
    } else {
      currentWeather = weatherSelect.value;
    }

    let colorVar = '--weather-clear';
    let text = 'Tiszta id≈ë';

    switch (currentWeather) {
      case 'clear': colorVar = '--weather-clear'; text = 'Tiszta id≈ë'; break;
      case 'cloudy': colorVar = '--weather-cloudy'; text = 'Felh≈ës'; break;
      case 'rain': colorVar = '--weather-rain'; text = 'Es≈ë'; break;
      case 'storm': colorVar = '--weather-storm'; text = 'Vihar'; break;
      case 'snow': colorVar = '--weather-snow'; text = 'Havas'; break;
    }

    const c = getComputedStyle(document.documentElement).getPropertyValue(colorVar).trim();
    weatherDisplay.innerHTML = `<span style="display:inline-block;width:20px;height:20px;background:${c};border-radius:50%;margin-right:8px;vertical-align:middle;"></span>${text}`;
  }

  // F≈ë friss√≠t≈ë ciklus (anim√°ci√≥)
  function mainLoop() {
    const now = Date.now();
    const delta = (now - lastUpdate) / 1000; // m√°sodperc
    lastUpdate = now;

    // Id≈ë halad√°sa
    const msToAdd = delta * 1000 * timeSpeed;
    worldTime = new Date(worldTime.getTime() + msToAdd);

    updateWorldTimeDisplay();
    updateDayCycle();
    updateWeatherDisplay();
    updateMagicState();
    checkForDailyEvent();
    setMagicLevel(determineAutoMagic(getCurrentHour(), getMoonPhase()));

    requestAnimationFrame(mainLoop);
  }

  // --- DM kezel≈ë ---

  // Ment√©s DM be√°ll√≠t√°sokba
    function saveDMSettings() {
      const settings = {
        magicLevel: magicLevel,
        magicAuto: magicAuto,
        timeSpeed: timeSpeed
      };
      localStorage.setItem('dmSettings', JSON.stringify(settings));
    }

    // Bet√∂lt√©s DM be√°ll√≠t√°sokb√≥l
    function loadDMSettings() {
      const saved = localStorage.getItem('dmSettings');
      if (saved) {
        const settings = JSON.parse(saved);
        magicLevel = settings.magicLevel || 'normal';
        magicAuto = settings.magicAuto !== undefined ? settings.magicAuto : true;
        timeSpeed = settings.timeSpeed || 1;

        // Friss√≠tsd a select-et √©s a timeSpeed inputot, ha van
        magicSelect.value = magicAuto ? 'auto' : magicLevel;
        timeSpeedInput.value = timeSpeed;
      }
    }


  function setDMPanelVisible(visible) {
    if (visible) {
      dmPanel.style.display = 'block';
      dmLoginSection.style.display = 'none';
      dmFeedback.textContent = '';
    } else {
      dmPanel.style.display = 'none';
      dmLoginSection.style.display = 'block';
      dmLoginError.textContent = '';
      dmPasswordInput.value = '';
    }
  }

  dmLoginBtn.addEventListener('click', () => {
    if (dmPasswordInput.value === DM_PASSWORD) {
      setDMPanelVisible(true);
    } else {
      dmLoginError.textContent = 'Hib√°s jelsz√≥!';
    }
  });

  logoutBtn.addEventListener('click', () => {
    setDMPanelVisible(false);
  });

  // Id≈ë be√°ll√≠t√°sa DM panelen
  timeSetInput.addEventListener('change', () => {
    const val = timeSetInput.value;
    if (!val) return;
    // Alak√≠tsuk √°t UTC id≈ëre
    const newTime = new Date(val);
    if (!isNaN(newTime.getTime())) {
      worldTime = new Date(newTime.getTime());
      dmFeedback.textContent = 'Vil√°gid≈ë friss√≠tve.';
    } else {
      dmFeedback.textContent = '√ârv√©nytelen d√°tum.';
    }
    saveDMSettings();
  });

  // Id≈ësebess√©g be√°ll√≠t√°sa
  timeSpeedInput.addEventListener('input', () => {
    let val = parseFloat(timeSpeedInput.value);
    if (isNaN(val) || val < 0) val = 1;
    if (val > 120) val = 120;
    timeSpeedInput.value = val;
    timeSpeed = val;
    dmFeedback.textContent = `Id≈ësebess√©g: ${val.toFixed(1)}x`;
    saveDMSettings();
  });

  // Id≈ëj√°r√°s kiv√°laszt√°s
  weatherSelect.addEventListener('change', () => {
    if (weatherSelect.value === 'auto') {
      weatherAuto = true;
      dmFeedback.textContent = 'Id≈ëj√°r√°s automatikus m√≥dra √°ll√≠tva.';
    } else {
      weatherAuto = false;
      currentWeather = weatherSelect.value;
      dmFeedback.textContent = `Id≈ëj√°r√°s manu√°lisan be√°ll√≠tva: ${weatherSelect.options[weatherSelect.selectedIndex].text}.`;
    }
    saveDMSettings();
  });

  // --- Pihen√©s gombok ---

  shortRestBtn.addEventListener('click', () => {
    worldTime = new Date(worldTime.getTime() + 60 * 60 * 1000);
    dmFeedback.textContent = 'R√∂vid pihen√©s (1 √≥ra) megt√∂rt√©nt.';
  });

  longRestBtn.addEventListener('click', () => {
    worldTime = new Date(worldTime.getTime() + 8 * 60 * 60 * 1000);
    dmFeedback.textContent = 'Hossz√∫ pihen√©s (8 √≥ra) megt√∂rt√©nt.';
  });

    // --- Ment√©s a localStorage-be ---

  // Bet√∂lt√©skor pr√≥b√°lja visszat√∂lteni az id≈ët
  const savedTime = localStorage.getItem('savedWorldTime');
  if (savedTime) {
    const parsed = Date.parse(savedTime);
    if (!isNaN(parsed)) {
      worldTime = new Date(parsed);
    }
  }

  // Oldal elhagy√°sakor menti az id≈ët
  window.addEventListener('beforeunload', () => {
    localStorage.setItem('savedWorldTime', worldTime.toISOString());
  });

  // --- magic ---


      // V√°ltoz√≥k
  let magicAuto = true;
  let magicLevel = 'normal'; // 'high', 'normal', 'low', 'null'

  const magicSelect = document.getElementById('magicSelect');

  // Esem√©nykezel≈ë a DM panelen bel√ºl
  magicSelect.addEventListener('change', () => {
    if (magicSelect.value === 'auto') {
      magicAuto = true;
      dmFeedback.textContent = 'A m√°gia szintje automatikus m√≥dra lett √°ll√≠tva.';
    } else {
      magicAuto = false;
      magicLevel = magicSelect.value;
      const labels = {
        high: 'Er≈ës',
        normal: 'Norm√°l',
        low: 'Gyenge',
        null: 'Nincs'
      };
      dmFeedback.textContent = `A m√°gia manu√°lisan be√°ll√≠tva: ${labels[magicLevel]}`;
    }
    updateMagicState();
    saveDMSettings();
  });





  function setMagicLevel(level) {
    magicLevel = level; // ahol a magicLevel a v√°ltoz√≥ a m√°giaszint t√°rol√°s√°ra
    updateMagicStatusDisplay(level);
    // egy√©b logik√°k, pl. √∫jrarajzol√°s stb.
  }

  let previousMagicLevel = null;


  // Automatikus m√°gia szint (p√©ld√°ul napszak vagy hold√°ll√°s alapj√°n)
  function determineAutoMagic(hour, moonPhase) {


   const weather = currentWeather
   let level = 2; // alap: norm√°l

  if (hour >= 22 || hour < 4) {
    if (weather === "clear") level = 4;
    else if (weather === "rain" || weather === "cloudy") level = 3;
    else level = 2;
  } else if (hour >= 6 && hour < 18) {
    if (weather === "clear") level = 1;
    else if (weather === "storm") level = 2;
    else level = 2;
  } else {
    level = 3;
  }

  if (moonPhase === "full" && level < 4) {
    level += 1;
  } else if (moonPhase === "new" && level > 1) {
    level -= 1;
  }

  const levelsText = {
    1: "Gyenge",
    2: "Norm√°l",
    3: "K√∂zepes",
    4: "Er≈ës"
  };

  return levelsText[level];
  saveDMSettings();
}

// Aktu√°lis √≥ra lek√©r√©se
function getCurrentHour() {
  return new Date().getHours();
}



// Egyszer≈± holdf√°zis sz√°m√≠t√°s (0-29 nap a holdh√≥nap)
function getMoonPhase() {
  const now = new Date();
  const synodicMonth = 29.53; // √°tlagos holdh√≥nap hossza napokban
  const newMoon = new Date(2000, 0, 6, 18, 14); // referencia √∫jhold (2000. janu√°r 6.)

  const daysSinceNewMoon = (now - newMoon) / 1000 / 60 / 60 / 24;
  const currentPhase = daysSinceNewMoon % synodicMonth;

  if (currentPhase < 1.84566) return "new";
  else if (currentPhase < 5.53699) return "waxing crescent";
  else if (currentPhase < 9.22831) return "first quarter";
  else if (currentPhase < 12.91963) return "waxing gibbous";
  else if (currentPhase < 16.61096) return "full";
  else if (currentPhase < 20.30228) return "waning gibbous";
  else if (currentPhase < 23.99361) return "last quarter";
  else if (currentPhase < 27.68493) return "waning crescent";
  else return "new";
}








  // M√°gia szint friss√≠t√©se
  function updateMagicState() {
    if (magicAuto) {
      magicLevel = determineAutoMagic();
      magicSelect.value = 'auto';
    }
  }

  function updateMagicStatusDisplay(level) {
    const magicLevelText = document.getElementById("magic-level-text");
    if (magicLevelText) {
      magicLevelText.textContent = level;
    }
  }


  // --- eventek---
      // Determinisztikus v√©letlenszer≈±s√©g (seed alapj√°n)
function seededDailyRandom(seed) {
  const x = Math.sin(seed) * 10000;
  return x - Math.floor(x);
}

// Esem√©ny gener√°tor
function generateDailyEvent(currentDate) {
  const daySeed = Math.floor(currentDate.getTime() / (1000 * 60 * 60 * 24));
  const r = seededDailyRandom(daySeed);

  if (r < 0.7) return null; // 60% es√©llyel nincs esem√©ny
  if (r < 0.90) return "Egy v√°ndor √©rkezik a v√°rosba.";
  if (r < 0.99) return "Egy k√∂zeli faluban elt≈±nt egy gyermek.";
  if (r < 1) return "S≈±r≈± k√∂d bor√≠tja a vid√©ket.";;
}

function events_comon(){
    const comon_event = [
      "",
    ];


    const daySeed = Math.floor(Math.random()*30);


}



// Utols√≥ napk√∂zbeni esem√©ny d√°tum t√°rol√≥
let lastEventDate = null;
let currentEventText = null;

// Napi esem√©ny ellen≈ërz≈ë
  function checkForDailyEvent() {
    const currentHour = worldTime.getUTCHours();
    const currentDate = new Date(Date.UTC(
      worldTime.getUTCFullYear(),
      worldTime.getUTCMonth(),
      worldTime.getUTCDate()
    ));

    if (
      currentHour >= 6 &&
      (!lastEventDate || lastEventDate.getTime() !== currentDate.getTime())
    ) {
      currentEventText = generateDailyEvent(currentDate);
      lastEventDate = currentDate;

      if (currentEventText) {
        console.log("üß≠ Napi esem√©ny:", currentEventText);
        showDailyEvent(currentEventText);
      } else {
        hideDailyEvent();
      }
    }
  }

  // Esem√©ny megjelen√≠t√©s
  function showDailyEvent(text) {
    const eventBox = document.getElementById("eventDisplay");
    eventBox.textContent = "Napi esem√©ny: " + text;
    eventBox.style.display = "block";
  }

  function hideDailyEvent() {
    const eventBox = document.getElementById("eventDisplay");
    eventBox.style.display = "none";
  }



  // --- dm interface off ---
  function dmpoff(){
    if(dmLoginSection.style.display == 'none'){
      dmLoginSection.style.display = 'block';
      }else{
        var element = document.getElementById("dmLoginSection");
        dmLoginSection.style.display = 'none';
      }
    }



  
  // --- to do list ---  

  // Bet√∂ltj√ºk a mentett lista elemeket localStorage-b√≥l
  function loadTodos() {
    const todos = JSON.parse(localStorage.getItem('todos') || '[]');
    todoList.innerHTML = ''; // √ºr√≠tj√ºk a list√°t
    todos.forEach((todo, index) => {
      addTodoElement(todo, index);
    });
  }

  // L√©trehoz egy <li> elemet a list√°hoz
  function addTodoElement(todoText, index) {
    const li = document.createElement('li');
    li.textContent = todoText;

    // T√∂rl√©s gomb minden elemhez
    const delBtn = document.createElement('button');
    delBtn.textContent = 'T√∂rl√©s';
    delBtn.style.marginLeft = '10px';
    delBtn.addEventListener('click', () => {
      removeTodo(index);
    });

    li.appendChild(delBtn);
    todoList.appendChild(li);
  }

  // √öj teend≈ë hozz√°ad√°sa
  function addTodo() {
    const todoText = todoInput.value.trim();
    if (todoText === '') return alert('√çrj be valamit!');

    const todos = JSON.parse(localStorage.getItem('todos') || '[]');

    if (todos.length >= 7) {
      alert('Maximum 7 elem lehet a list√°ban!');
      return; // nem ad hozz√° t√∂bbet
    }

    todos.push(todoText);
    localStorage.setItem('todos', JSON.stringify(todos));

    todoInput.value = '';
    loadTodos();
  }

  // Teend≈ë t√∂rl√©se index alapj√°n
  function removeTodo(index) {
    const todos = JSON.parse(localStorage.getItem('todos') || '[]');
    todos.splice(index, 1);
    localStorage.setItem('todos', JSON.stringify(todos));
    loadTodos();
  }




  // --- Ind√≠t√°s ---
  loadDMSettings();
  loadTodos();
  mainLoop()
  updateWorldTimeDisplay();
  updateDayCycle();
  updateWeatherDisplay();
  setDMPanelVisible(false);

  lastUpdate = Date.now();
  requestAnimationFrame(mainLoop);

</script>
</body>
</html>
